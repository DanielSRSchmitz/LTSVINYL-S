<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo | LTS VINYL-S</title>
    <link rel="stylesheet" href="css/stylevenda.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

<header>
    <nav>
        <div class="logo">LTS <span>VINYL-S</span></div>
        <ul>
            <li><a href="index.html">Início</a></li>
            <li><a href="discos.html" class="active">Discos</a></li>
            <li><a href="contacto.html">Contacto</a></li>
        </ul>
    </nav>
</header>

<div class="loja-container">
    <aside class="sidebar">
        <h3>Filtrar Vinis</h3>
        <div class="filtro-grupo">
            <label>Pesquisar</label>
            <input type="text" id="busca" placeholder="Nome do álbum ou artista...">
        </div>
        <div class="filtro-grupo">
            <label>Género</label>
            <select id="genero">
                <option value="todos">Todos os Géneros</option>
                <option value="rock">Rock</option>
                <option value="jazz">Jazz</option>
                <option value="pop">Pop</option>
                <option value="hiphop">Hip Hop</option>
            </select>
        </div>
        <div class="filtro-grupo">
            <label>Preço até</label>
            <input type="range" id="precoRange" min="10" max="150" value="150">
            <span id="precoValor">150€</span>
        </div>
    </aside>

    <main class="catalogo">
        <div class="grid-produtos" id="grid-produtos">
            <p id="status">A carregar discos do Firebase...</p>
        </div>
    </main>
</div>

<script type="module">
    // Importar SDKs do Firebase (Versão Modular 9+)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- COPIA OS TEUS DADOS DO FIREBASE AQUI ---
    const firebaseConfig = {
    apiKey: "BBwuWn4Y0bENTnpuBGUejJZMzyBrQZDwsLAmswPhkFLHOx5_8jXb2GshqsW4VJCVSxVhpCPF4I4wBMf48FxhAiw", // Encontra isto em 'Seus aplicativos'
    authDomain: "ltsvinils.firebaseapp.com",
    projectId: "ltsvinils",
    storageBucket: "ltsvinils.appspot.com",
    messagingSenderId: "814606881822", // Este é o 'Número do projeto' da tua Imagem 10
    appId: "814606881822"   // Também em 'Seus aplicativos'
};

    // Inicializar Firebase e Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const grid = document.getElementById('grid-produtos');
    
    let todosOsDiscos = [];

    // 1. Função para carregar discos da coleção 'discos'
    async function carregarDiscos() {
        try {
            const querySnapshot = await getDocs(collection(db, "discos"));
            todosOsDiscos = [];
            
            querySnapshot.forEach((doc) => {
                todosOsDiscos.push({ id: doc.id, ...doc.data() });
            });

            renderizarCards(todosOsDiscos);
        } catch (error) {
            console.error("Erro ao carregar:", error);
            grid.innerHTML = "<p>Erro ao carregar dados do Firebase. Verifica as permissões.</p>";
        }
    }

    // 2. Renderizar os cards no HTML
    function renderizarCards(lista) {
        grid.innerHTML = "";
        if (lista.length === 0) {
            grid.innerHTML = "<p>Nenhum vinil encontrado na base de dados.</p>";
            return;
        }

        lista.forEach(disco => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <div class="disco-img" style="background-image: url('${disco.imagem}');"></div>
                <div class="card-info">
                    <span class="tag">${disco.genero}</span>
                    <h3>${disco.titulo}</h3>
                    <p class="artista">${disco.artista}</p>
                    <p class="preco">${parseFloat(disco.preco).toFixed(2)}€</p>
                    <button class="btn-comprar"><i class="fa-solid fa-cart-shopping"></i> Comprar</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // 3. Sistema de Filtros
    function filtrar() {
        const texto = document.getElementById('busca').value.toLowerCase();
        const generoSel = document.getElementById('genero').value.toLowerCase();
        const precoMax = parseInt(document.getElementById('precoRange').value);
        document.getElementById('precoValor').innerText = precoMax + "€";

        const filtrados = todosOsDiscos.filter(disco => {
            const bateTexto = disco.titulo.toLowerCase().includes(texto) || 
                             disco.artista.toLowerCase().includes(texto);
            const bateGenero = generoSel === 'todos' || disco.genero.toLowerCase() === generoSel;
            const batePreco = parseFloat(disco.preco) <= precoMax;
            return bateTexto && bateGenero && batePreco;
        });

        renderizarCards(filtrados);
    }

    // Listeners
    document.getElementById('busca').addEventListener('keyup', filtrar);
    document.getElementById('genero').addEventListener('change', filtrar);
    document.getElementById('precoRange').addEventListener('input', filtrar);

    // Iniciar
    carregarDiscos();
</script>
</body>
</html>